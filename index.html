<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" name="viewport" content="width=device-width,initial-scale=1">
    <!--<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">-->
    <link rel="stylesheet" href="js/jquery.mobile-1.3.2.min.css">
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/jquery.mobile-1.3.2.min.js"></script>




</head>

<body>

<div data-role="page" id="index">
    <div data-role="header" data-theme="c">
        <h1>掐一秒</h1>

    </div>
    <div data-role="content" align="center">
        <p>掐一秒游戏操作非常简单</p>
        <P>你只需要每隔一秒钟点击一次屏幕</p>
        <p>保持平和的心态最关键</p>
        <p>祝你取得好成绩</p>


        <a href="#jixian" data-role="button"   data-transition="slide">开始游戏</a>
        <a href="rank.html" data-role="button"   data-transition="slide">排行榜</a>

    </div>
</div>

<div data-role="page" id="jixian">
    <a href="#index" data-role="button" data-inline="true"  data-icon="home"  data-transition="slide" data-direction="reverse" data-iconpos="notext">首页</a>

    <div  data-role="content" align='center'>
        <p>连续掐出1秒，误差小于50毫秒</p>
        <h1 id="sum">总分:0</h1>
        <h1 id="time">0.000</h1>

        <ol data-role="listview" data-inset="true" id="results" >

        </ol>
        <a data-role="button" href="#form_page"  data-rel="popup" id="bt_show">秀一下</a>
    </div>
    <button type="button" id="button">Start!</button>




    <div data-role="popup" id="form_page" data-theme="c">
        <form id="form">
            <div style="padding:10px 20px;">
                <h3>分享到朋友圈</h3>
                <p>我在掐一秒游戏取得了:</p>
                <h3 id="txt_show_sum"></h3>
                <p>荣获称号:</p>
                <h3 id="txt_show_name"></h3>
                <input type="text" id="name" value="" placeholder="输入昵称" data-theme="c" />
                <button type="button" data-theme="c" id="bt_share">确定</button>
            </div>
        </form>

    </div>


</div>



</body>
<script type="text/javascript">

    $(document).ready(function() {

        $(document).on("pageshow", "#jixian", init);
        $("#bt_share").click(function(){
           $("#form_page").popup("close");

            if ( $("#name").val() != ""){
                $.post("/server/rank.php",
                        {
                            action:"insert",
                            name:$("#name").val(),
                            points:sum,
                            title:document.getElementById("txt_show_name").innerHTML
                        },
                        function(data,status){
                            alert(data);
                        });

            }

        });




    });




    var errorvalue = 50;
    var sum = 0;
    var startTime;
    var time;
    var endTime;
    var temp;
    var arr_results = new Array();
    var title = new Array('不堪一击','毫不足虑','不足挂齿','初学乍练','勉勉强强','初窥门径','初出茅庐','略知一二','普普通通','平平常常','平淡无奇','粗懂皮毛','半生不熟','登堂入室','略有小成','已有小成','鹤立鸡群','驾轻就熟','青出於蓝','融会贯通','心领神会','炉火纯青','了然於胸','略有大成','已有大成','豁然贯通','非比寻常','出类拔萃','罕有敌手','技冠群雄','神乎其技','出神入化','傲视群雄','登峰造极','无与伦比','所向披靡','一代宗师','精深奥妙','神功盖世','举世无双','惊世骇俗','撼天动地','震古铄今','超凡入圣','威镇寰宇','空前绝后','天人合一','深藏不露','深不可测','返璞归真','极准很准');


    function init(){
        var obj = document.getElementById('button');
        obj.addEventListener("touchstart",buttonPressed,false);

        while (document.getElementById('results').children[0] != null) {

            document.getElementById('results').removeChild(document.getElementById('results').children[0]);
        }
        arr_results = new Array();
        document.getElementById('button').innerHTML = "Start!";
        $("#button").button("refresh");
        updateTime(0);
        sum = 0;
        document.getElementById('sum').innerHTML = "总分:"+sum;

        $('#bt_show').css('display','none');

    }

    function buttonPressed(){


        endTime = new Date().getTime();
        if ( document.getElementById('button').innerHTML == "Start!") {
            document.getElementById('button').innerHTML = "Lap!";
            $("#button").button("refresh");
            startTime = new Date().getTime();
            change();
        }else if (document.getElementById('button').innerHTML == "Lap!") {
            var result = Number(endTime) - Number(startTime);

            if (Math.abs(result-1000)<=errorvalue) {
                if (Math.abs(result-1000)==0) {
                    var points = 300;
                }else {
                    var points = 100 + parseInt(100 -2 * Math.abs(result-1000));
                }
                startTime = new Date().getTime();
                sum+=points;
                document.getElementById('sum').innerHTML = "总分:"+sum;
                arr_results.push("得分:"+points+"计时:"+(result / 1000).toFixed(3));


            }else {
                var i = 0;
                while (i < arr_results.length){
                    var para=document.createElement("li");
                    para.innerHTML=arr_results[i];
                    $('#results').append(para);
                    i++;
                }
                document.getElementById("txt_show_sum").innerHTML = sum+"分";

                document.getElementById("txt_show_name").innerHTML = title[(sum>51000) ? 50 : (parseInt(sum/1000))];
                $("#results").listview('refresh');
                updateTime(result);
                clearTimeout(temp);
                document.getElementById('button').innerHTML = "再来一次";
                $("#button").button("refresh");
                $('#bt_show').css('display','');
            }


        }else{
           init();

        }




    }
    function change(){
        endTime = new Date().getTime();
        time = Number(endTime) - Number(startTime);
        updateTime(time);

        temp=setTimeout("change()",5);
    }


    function updateTime(t){
        document.getElementById('time').innerHTML = (t/1000).toFixed(3);
    }

</script>
</html>