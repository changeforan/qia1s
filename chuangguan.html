<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8" name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="js/jquery.mobile-1.3.2.min.css">
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/jquery.mobile-1.3.2.min.js"></script>

</head>


<body onload="init()">
<div data-role="page" id="chuangguan" >
    <div data-role="header">
        <h1>闯关模式</h1>
    </div>



    <div  data-role="content" align='center'>
        <p id="txt_guan">111111</p>
        <h1 id="time">00.00</h1>
        <button type="button" id="button_time">Start!</button>
        <button type="button"  onclick="location='index.html'" >退出游戏</button>
        <ol id="results">

        </ol>
    </div>


</div>
</body>
<script type="text/javascript">
    var startTime;
    var endTime;
    var t;
    var time;
    var num_guan;
    var total_guan = 4;
    var guan = new Array();
    guan[0] = {
      txt:"关卡一：掐出一个1秒，误差300毫秒。",
      seconds:1,
      errorvalue:300

    };
    guan[1] = {
        txt:"关卡二：掐出一个1秒，误差100毫秒。",
        seconds:1,
        errorvalue:100
    };

    guan[2] = {
        txt:"关卡三：掐出一个2秒，误差100毫秒。",
        seconds:2,
        errorvalue:100
    };

    guan[3] = {
        txt:"关卡四：掐出一个2秒，误差50毫秒。",
        seconds:2,
        errorvalue:50
    };
    guan[4] = {
        txt:"关卡五：掐出一个3秒，误差50毫秒。",
        seconds:3,
        errorvalue:50
    };

    guan[5] = {
        txt:"关卡六：掐出一个1秒，误差20毫秒。",
        seconds:1,
        errorvalue:20
    };

    guan[6] = {
        txt:"关卡七：掐出一个1秒，误差0毫秒。",
        seconds:1,
        errorvalue:0
    };



    function timePressed(){

        if (document.getElementById('button_time').innerHTML == "Start!" ) {
            document.getElementById('button_time').innerHTML="Stop!";
            $("#button_time").button("refresh");
            document.getElementById('time').innerHTML="00.00";
            startTime = new Date().getTime();
            time = 0;
            change();
        }else {
            document.getElementById('button_time').innerHTML="Start!";
            $("#button_time").button("refresh");
            clearTimeout(t);
            endTime = new Date().getTime();
            var result = Number(endTime) - Number(startTime);
            updateTime(result);

            var para=document.createElement("li");
            var node=document.createTextNode(document.getElementById('time').innerHTML);
            para.appendChild(node);
            document.getElementById('results').appendChild(para);

           if ( Math.abs(parseInt(guan[num_guan].seconds) * 1000 - result) < parseInt(guan[num_guan].errorvalue) ) {
               alert("恭喜过关！");
               nextguan();

           }

            
        }
    }

    function nextguan(){
        if (num_guan < total_guan) {
            num_guan = num_guan + 1;

            document.getElementById('txt_guan').innerHTML = guan[num_guan].txt;
            while (document.getElementById('results').children[0] != null) {

                document.getElementById('results').removeChild(document.getElementById('results').children[0]);
            }
        } else {
            alert('恭喜通关！');
            self.location="index.html";

        }
    }

    function change(){
        updateTime(time);
        endTime = new Date().getTime();
        time = Number(endTime) - Number(startTime);
        t=setTimeout("change()",10);
    }


    function updateTime(t){
        document.getElementById('time').innerHTML = (t/1000).toFixed(3);
    }



    function init(){
        var obj = document.getElementById('button_time');
        obj.addEventListener("touchstart",timePressed,false);
        num_guan = 0;
        document.getElementById('txt_guan').innerHTML = guan[num_guan].txt;

    }


</script>
</html>
